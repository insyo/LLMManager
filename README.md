# LLMManager

## これはなに？

ChatGPT API function callingに対応したラッパークラスです。

簡単にFunction callingを使えるようにしました。

- ChatGPTに渡す関数定義は、関数のdocstringに書くだけで良い
- Function CallingがChatGPTから要求される間は自動的にループ

## 準備

.envにOpenAI API KEYを指定してください。

```
OPENAI_API_KEY=sk-.....
```

また、依存ライブラリをインストールしておいてください。

```bash
$ pip install -r requirements.txt
```

## クラスの使い方

### function callingで呼び出す関数の作成

呼び出したい関数は下記の形式で作成します。

- docstring

    ChatGPTに事前に教える関数に関する情報をJSON形式で記入します。
    記載方法は`demo.py`を参考にしてください。

- 戻り値

    `status`と`message`の2つのキーを持つ辞書をreturnするようにしてください。
    こちらも`demo.py`を参考にしてください。

### クラスの具体的な使い方

`FunctionCallableLLMManager`インスタンスを生成し、`get_response`メソッドのパラメータに「プロンプト」と「関数のリスト」を渡します。

ChatGPTがfuncation callingを指定してくる間は何度でも指定された関数を呼び出します。

最終回答がChatGPTから返却されると、上記メソッドからリターンします。

具体的な使用方法は`demo.py`を参考にしてください。

## デモ

### 概要

`demo.py`はsqlite3を自然言語で操作するデモプログラムです。

- テーブルの作成・削除
- ダミーデータの挿入
- 検索・更新などなど

上記の操作を自然言語で行うことができます。

ただし、時折エラーになるクエリーを何度も繰り返してToken数オーバーになることもあります。

適切なクエリーを生成できるように、プロンプトを工夫してみてください。

### プロンプトの例

- テーブルの一覧を表示して
- 商品の売り上げ明細を格納するテーブルを作成し、ダミーデータを30件挿入して
- 売り上げ明細のスキーマを教えて
- 売り上げ明細の件数は？
- 売り上げ貢献TOP5の商品を表形式で表示して
- 商品単価の安いものTOP5をCSV形式で出力して
- すべてのテーブル内のレコードを削除して
- すべてのテーブルを削除して
- テーブルの一覧を表示して
